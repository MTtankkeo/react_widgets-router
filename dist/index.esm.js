import{jsx as t,Fragment as e}from"react/jsx-runtime";import{useRef as n,useLayoutEffect as s,useContext as o,useState as r,createContext as i}from"react";class a{static get pathname(){return location.pathname}static arrayOf(t){return console.assert("A given path does not exist nothing."!=t),Array.from(t.matchAll(/(?<=\/)[\w-]+(?=\/|$)/g)).map((t=>t[0]))}}function l({route:o,active:r,first:i}){const a=n(r),l=n(null),c=null==o?void 0:o.props.component,u=null==o?void 0:o.props.element,h=null!=u?u:t(c||e,{});return s((()=>{const t=l.current;if(t&&i&&a.current==r)r||(t.style.display="none");else if(t){a.current=r;const e=getComputedStyle(t),n=e.getPropertyValue("--router-fadein-keyframe").replaceAll('"',""),s=e.getPropertyValue("--router-fadein-duration"),o=e.getPropertyValue("--router-fadeout-keyframe").replaceAll('"',""),i=e.getPropertyValue("--router-fadeout-duration");if(r){if(t.style.display="unset",n)return t.style.animation=`${n} ${s||"0.3s"}`,void(t.onanimationend=null)}else{if(o)return t.style.animation=`${o} ${i||"0.3s"}`,void(t.onanimationend=()=>t.style.display="none");t.style.display="none"}}a.current=r}),[r]),t("route-sliver",{ref:l,children:h})}addEventListener("DOMContentLoaded",(()=>{const t=new CSSStyleSheet;t.insertRule("\n        route-sliver {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n        }\n    "),t.insertRule("\n        *:has(> route-sliver) {\n            position: relative;\n            top: 0px;\n            left: 0px;\n        }\n    "),document.adoptedStyleSheets=[...document.adoptedStyleSheets,t]}));class c{constructor(){this.listeners=[],window.onpopstate=t=>this.notifyListeners(location.pathname)}static get instance(){var t;return null!==(t=this._instance)&&void 0!==t?t:this._instance=new c}addListener(t){console.assert(!this.listeners.includes(t),"Already exists a given listener in the context."),this.listeners.push(t)}removeListener(t){console.assert(this.listeners.includes(t),"Already not exists a given listener in the context."),this.listeners=this.listeners.filter((e=>e!=t))}notifyListeners(t){this.listeners.forEach((e=>e(t)))}push(t){location.pathname!=t&&(this.notifyListeners(t),history.pushState(null,"",t))}move(t){location.pathname!=t&&(history.replaceState({},"",t),this.notifyListeners(location.pathname))}forward(){history.forward(),this.notifyListeners(location.pathname)}backward(){history.back(),this.notifyListeners(location.pathname)}}class u{constructor(t){this.location=t,this.consumedPath=[],this.paths=[],this.paths=a.arrayOf(t)}get first(){return this.paths[0]}get relPath(){return"/"+this.paths.join("/")}get absPath(){return"/"+this.consumedPath.join("/")+this.paths.join("/")}get clone(){const t=new u(this.location);return t.paths=this.paths,t.consumedPath=this.consumedPath,t}consume(){return console.assert(0!=this.paths.length,"Not exists a path that can be consumed."),this.paths[0]&&this.consumedPath.push(this.paths[0]),this.paths=this.paths.slice(1)}}const h=i(null);function p({location:s,children:i}){const p=n(new Map),d=function(){let t=o(h),e=c.instance;if(null==t){const[n,s]=r(window.location.pathname);t=new u(n),e.addListener(s)}return t}(),m=Array.isArray(i)?i:[i];let f=m.find((t=>a.arrayOf(t.props.path)[0]==d.first&&null==s||a.arrayOf(t.props.path)[0]==a.arrayOf(null!=s?s:"")[0]&&s));return f&&0!=d.paths.length&&d.consume(),null!=f||(f=m.find((t=>t.props.default))),f&&p.current.set(f.props.path,{context:d.clone}),t(e,{children:Array.from(p.current).map((([e,n],s)=>{const o=(null==f?void 0:f.props.path)==e,r=m.find((t=>t.props.path==e));return t(h.Provider,{value:n.context.clone,children:t(l,{active:o,first:0==s,route:r},e)})}))})}function d(t){var e;return console.assert(null!=t.element||null!=t.component,"Not exists a given component"),console.assert(null==t.element&&null!=t.component,"Cannot define rendering a component."),console.assert(null!=t.element&&null==t.component,"Cannot define rendering a component."),null!==(e=t.component)&&void 0!==e?e:t.element}function m(){var t;const e=null!==(t=o(h))&&void 0!==t?t:new u(window.location.pathname),s=n(e);return s.current===e?s.current.clone:s.current=e}var f;function v(t){var e;const n=null!==(e=null==t?void 0:t.context)&&void 0!==e?e:m();return e=>{var s,o,r;const i=null!==(s=null==t?void 0:t.routing)&&void 0!==s?s:f.relative,a=e.startsWith("/")?e.slice(1):e;i==f.absolute?null!==(o=null==t?void 0:t.replace)&&void 0!==o&&o?c.instance.move(e):c.instance.push(e):null!==(r=null==t?void 0:t.replace)&&void 0!==r&&r?c.instance.move("/"+[...n.consumedPath,a].join("/")):c.instance.push("/"+[...n.consumedPath,a].join("/"))}}!function(t){t[t.absolute=0]="absolute",t[t.relative=1]="relative"}(f||(f={}));export{d as Route,p as Router,c as RouterBinding,u as RouterContext,m as useLocation,v as useRouter};
