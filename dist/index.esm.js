import{jsx as t,Fragment as e}from"react/jsx-runtime";import{useContext as n,useState as s,useRef as r,useLayoutEffect as i,createContext as o}from"react";class a{static get pathname(){return location.pathname}static arrayOf(t){return console.assert("A given path does not exist nothing."!=t),Array.from(t.matchAll(/(?<=\/)[\w-]+(?=\/|$)/g)).map((t=>t[0]))}}class l{constructor(t){this.consumedPath=[],this.paths=[],this.paths=a.arrayOf(t)}get first(){return this.paths[0]}get relPath(){return"/"+this.paths.join("/")}get absPath(){return"/"+this.consumedPath.join("/")+this.paths.join("/")}consume(){return console.assert(0!=this.paths.length,"Not exists a path that can be consumed."),this.paths[0]&&this.consumedPath.push(this.paths[0]),this.paths=this.paths.slice(1)}}class u{constructor(){this.listeners=[],window.onpopstate=t=>this.notifyListeners(location.pathname)}static get instance(){var t;return null!==(t=this._instance)&&void 0!==t?t:this._instance=new u}addListener(t){console.assert(!this.listeners.includes(t),"Already exists a given listener in the context."),this.listeners.push(t)}removeListener(t){console.assert(this.listeners.includes(t),"Already not exists a given listener in the context."),this.listeners=this.listeners.filter((e=>e!=t))}notifyListeners(t){this.listeners.forEach((e=>e(t)))}push(t){location.pathname!=t&&(this.notifyListeners(t),history.pushState(null,"",t))}replace(t){location.pathname!=t&&(this.notifyListeners(t),history.replaceState({},"",t))}pop(t){this.notifyListeners(t),history.back()}}function h(){let t=n(p),e=u.instance;if(null==t){const[n,r]=s(window.location.pathname);t=new l(n),e.addListener((t=>{r(t)}))}return t}function c({route:n,active:s,first:o}){const a=r(s),l=r(null),u=null==n?void 0:n.props.component,h=null==n?void 0:n.props.element,c=null!=h?h:t(u||e,{});return i((()=>{const t=l.current;if(t&&o&&a.current==s)s||(t.style.display="none");else if(t){a.current=s;const e=getComputedStyle(t),n=e.getPropertyValue("--router-fadein-keyframe").replaceAll('"',""),r=e.getPropertyValue("--router-fadein-duration"),i=e.getPropertyValue("--router-fadeout-keyframe").replaceAll('"',""),o=e.getPropertyValue("--router-fadeout-duration");if(s){if(t.style.display="unset",n)return t.style.animation=`${n} ${r||"0.3s"}`,void(t.onanimationend=null)}else{if(i)return t.style.animation=`${i} ${o||"0.3s"}`,void(t.onanimationend=()=>t.style.display="none");t.style.display="none"}}a.current=s}),[s]),t("route-sliver",{ref:l,children:c})}addEventListener("DOMContentLoaded",(()=>{const t=new CSSStyleSheet;t.insertRule("\n        route-sliver {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n        }\n    "),t.insertRule("\n        *:has(> route-sliver) {\n            position: relative;\n            top: 0px; left: 0px;\n        }\n    "),document.adoptedStyleSheets=[...document.adoptedStyleSheets,t]}));const p=o(null);function d({location:e,children:n}){const s=r(new Set),i=h(),o=Array.isArray(n)?n:[n];let l=o.find((t=>a.arrayOf(t.props.path)[0]==i.first&&null==e||a.arrayOf(t.props.path)[0]==a.arrayOf(null!=e?e:"")[0]&&e));return l&&0!=i.paths.length&&i.consume(),null!=l||(l=o.find((t=>t.props.default))),l&&0==s.current.has(l.props.path)&&s.current.add(l.props.path),t(p.Provider,{value:i,children:Array.from(s.current).map(((e,n)=>{const s=(null==l?void 0:l.props.path)==e,r=o.find((t=>t.props.path==e));return t(c,{active:s,first:0==n,route:r},e)}))})}function f({component:t,element:e}){return console.assert(null!=e||null!=t),console.assert(null==e&&null!=t),console.assert(null!=e&&null==t),null!=t?t:e}var y;function m(t){var e;const n=null!==(e=null==t?void 0:t.context)&&void 0!==e?e:h();return e=>{var s;const r=null!==(s=null==t?void 0:t.routing)&&void 0!==s?s:y.relative,i=e.startsWith("/")?e.slice(1):e;r==y.absolute?u.instance.push(e):u.instance.push("/"+[...n.consumedPath,i].join("/"))}}!function(t){t[t.absolute=0]="absolute",t[t.relative=1]="relative"}(y||(y={}));export{f as Route,d as Router,u as RouterBinding,l as RouterContext,h as useLocation,m as useRoute};
